---
title: "Google Spreadsheetã¨Google Slidesã§ãŠæ‰‹è»½å‹•çš„OGP with Nuxt"
tags: [Google Spreadsheet, Google Slides, Nuxt.js, GAS, OGP]
date: '2021-10-14'
published: true
---

ã„ã¾è©±é¡Œã®ã‚¹ãƒšãƒ¼ã‚¹ã«å‡ºä¼šãˆã‚‹ spaces.bzï¼ˆã‚¯ãƒ­ãƒ¼ã‚ºæ¸ˆã¿ï¼‰ã§ã¯ã€ãƒ‡ã‚¤ãƒªãƒ¼ãƒ©ãƒ³ã‚­ãƒ³ã‚°ã§å‹•çš„OGPã‚’å®Ÿè£…ã—ã¦ã„ã¾ã™ã€‚

å®Ÿã¯ã“ã‚Œã€Google Spreadsheetã¨Google Slidesã‚’ä½¿ã£ã¦ã€GASã§æ¯æ—¥OGPç”»åƒã‚’ç”Ÿæˆã—ã¦è¡¨ç¤ºã•ã›ã¦ã„ã‚‹ã‚“ã§ã™ã€‚
çµæ§‹é¢ç™½ã„ã‚¢ã‚¤ãƒ‡ã‚¢ã‹ãªã€ã¨æ€ã†ã®ã§ã‚·ã‚§ã‚¢ã—ã¾ã™ï¼ğŸ˜Š

# å…¨ä½“åƒ
ã¾ãšã“ã®è¨˜äº‹ã§ç´¹ä»‹ã™ã‚‹å…¨ä½“åƒã‚’ã€‚

1. å‹•çš„OGPã®ã‚‚ã¨ã«ãªã‚‹Slidesã‚’ä½œæˆ
1. å‹•çš„OGPã®ãƒ‡ãƒ¼ã‚¿ã®ã‚‚ã¨ã«ãªã‚‹Spreadsheetã‚’ä½œæˆ
1. GASã‚’ä½œæˆ
    - Spreadsheetã®ãƒ‡ãƒ¼ã‚¿ã‚’ã‚‚ã¨ã«Slidesã®æ–‡å­—åˆ—ã‚’ç½®æ›
    - Slidesã‚’ç”»åƒãƒ•ã‚¡ã‚¤ãƒ«ã§ã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆã—ã¦Driveã«ä¿å­˜
    - Spreadsheetã«Driveã«ä¿å­˜ã—ãŸç”»åƒãƒ•ã‚¡ã‚¤ãƒ«ã®IDã‚’è¿½åŠ 
    - Slidesã‚’å…ƒã®æ–‡å­—åˆ—ã«ç½®æ›ã—ç›´ã™
1. Spreadsheetã‚’WebAppï¼ˆAPIï¼‰ã§å…¬é–‹
1. Nuxtã‚¢ãƒ—ãƒªã§å‹•çš„OGPã‚’è¨­å®š

ã¡ã‚‡ã£ã¨é•·ã„ã§ã™ãŒã€ãŠä»˜ãåˆã„ã„ãŸã ã‘ã‚‹ã¨å¬‰ã—ã„ã§ã™ğŸ™

# 1. å‹•çš„OGPã®å…ƒã«ãªã‚‹Slidesã‚’æº–å‚™
ã¾ãšã¯ã„ã„æ„Ÿã˜ã®OGPã®ãƒ‡ã‚¶ã‚¤ãƒ³ã‚’Google Slidesã§ä½œã‚Šã¾ã™ã€‚

![slidesã®ã‚¤ãƒ¡ãƒ¼ã‚¸](./images/1_slides_image.png)

Coolã§ã™ã€‚ãƒã‚¤ãƒ³ãƒˆã¨ã—ã¦ã¯OGPã¯1200mmx628mmã®ã‚µã‚¤ã‚ºãŒã‚ˆã„ã®ã§ã€ã€Œãƒ•ã‚¡ã‚¤ãƒ« > ãƒšãƒ¼ã‚¸è¨­å®šã€ã‹ã‚‰ã‚¹ãƒ©ã‚¤ãƒ‰ã®ç¸¦æ¨ªã‚µã‚¤ã‚ºã‚’å¤‰æ›´ã—ã¦ã¾ã™ã€‚

ã“ã®ã‚¹ãƒ©ã‚¤ãƒ‰ã«æ›¸ã„ã¦ã„ã‚‹ã€Œnameã€ã¯ã“ã®å¾Œç½®æ›ã™ã‚‹ãŸã‚ã®ã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰ã«ãªã£ã¦ã¾ã™ã€‚

# 2. å‹•çš„OGPã®ãƒ‡ãƒ¼ã‚¿ã®ã‚‚ã¨ã«ãªã‚‹Spreadsheetã‚’æº–å‚™
ã€Œnameã€ã‚’ç½®æ›ã—ã¦ã„ããŸã„ã®ã§ã€ãã‚“ãªæ„Ÿã˜ã®Spreadsheetã‚’ç”¨æ„ã—ã¾ã™ã€‚
spaces.bz ã®å ´åˆã¯ã€ãã®æ—¥ã®ãƒ©ãƒ³ã‚­ãƒ³ã‚°10ä½ã¾ã§ã‚’GASã§é›†è¨ˆã—ã¦ã€ãã®ãƒ‡ãƒ¼ã‚¿ã‚’å…ƒã«ç½®æ›ã‚’è¡Œã£ã¦ã„ã¾ã™ã€‚
ä»Šå›ã¯ç°¡å˜ãªä¾‹ãªã®ã§ã€ä»¥ä¸‹ã®ã‚ˆã†ãªã‚·ãƒ¼ãƒˆã‚’ç”¨æ„ã—ã¾ã™ã€‚

|id|name|ogpId|
| --- | --- | --- |
|1|Test A||
|2|Test B||
|3|Test C||

`ogp_id`ã¯ä»Šã®ã¨ã“ã‚ç©ºã§ã™ãŒåˆ—ã ã‘ç”¨æ„ã—ã¦ãŠãã¾ã™ã€‚å¾Œã§GASã§OGPç”»åƒã®ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ç”Ÿæˆã—ãŸã¨ãã«ç”»åƒãƒ•ã‚¡ã‚¤ãƒ«ã®IDã‚’ã‚»ãƒƒãƒˆã™ã‚‹ã‚«ãƒ©ãƒ ã§ã™ã€‚

# 3. GASã‚’ä½œæˆ
ã“ã®è¨˜äº‹ã®ä½³å¢ƒã§ã™ï¼

ã¾ãšã‚³ãƒ¼ãƒ‰ã®å…¨å®¹ã‚’ã•ã‚‰ã—ã¾ã™ã€‚
èª¬æ˜ã—ã‚„ã™ã„ã‚ˆã†ã«æ›¸ã„ã¦ã„ã¾ã™ãŒã€å†…å®¹ã‚’ç†è§£ã„ãŸã ã‘ã‚Œã°è‰²ã€…ãªæ›¸ãæ–¹ãŒã‚ã‚‹ã‹ãªãƒ¼ã¨æ€ã„ã¾ã™ã€‚

```js:ã‚³ãƒ¼ãƒ‰.js
function main() {
  const ss = SpreadsheetApp.openById('<Spreadsheetã®ID>')
  const sheet = ss.getSheetByName('<Sheetã®åå‰>')
  const data = sheet.getDataRange().getValues()
  const columnNames = data.shift()
  const presentationId = '<Slidesã®ID>'
  const folder = DriveApp.getFolderById('<Folderã®ID>')

  data.forEach((row, index) => {
    const name = row[1]
    replaceText(presentationId, name)
    const ogpId = downloadImage(presentationId, `${index}.png`, folder)
    row[2] = ogpId
    resetText(presentationId, name)
  })

  data.unshift(columnNames)
  sheet.getRange(1, 1, data.length, data[0].length).setValues(data)
}

function replaceText(presentationId, name) {
  const presentation = SlidesApp.openById(presentationId)
  const slide = presentation.getSlides()[0]
  slide.replaceAllText('name', name)
  presentation.saveAndClose()  
}

function downloadImage(presentationId, fileName, folder) {
  const presentation = SlidesApp.openById(presentationId)
  const slide = presentation.getSlides()[0]
  const slideId = slide.getObjectId()
  const url = `https://docs.google.com/presentation/d/${presentationId}/export/png?id=${presentationId}&pageId=${slideId}`
  const options = {
    headers: {
      Authorization: `Bearer ${ScriptApp.getOAuthToken()}`
    }
  }

  const response = UrlFetchApp.fetch(url, options)
  const image = response.getAs(MimeType.PNG)
  image.setName(fileName)
  const file = folder.createFile(image)
  return file.getId()
}

function resetText(presentationId, name) {
  const presentation = SlidesApp.openById(presentationId)
  const slide = presentation.getSlides()[0]
  slide.replaceAllText(name, 'name')
  presentation.saveAndClose()
}
```

å°‘ã—é•·ã„ã§ã™ãŒã€å°‘ã—ãšã¤åŒºåˆ‡ã£ã¦ã¿ã¦ã„ãã¾ã™ã€‚

## 3-1. å„ç¨®å¤‰æ•°ã®è¨­å®š
```js
const ss = SpreadsheetApp.openById('<Spreadsheetã®ID>')
const sheet = ss.getSheetByName('<Sheetã®åå‰>')
const data = sheet.getDataRange().getValues()
const columnNames = data.shift()
const presentationId = '<Slidesã®ID>'
const folder = DriveApp.getFolderById('<Folderã®ID>')
```

æœ€åˆã®`const`ãŸã¡ã¯å¤‰æ•°ã®è¨­å®šã§ã™ã€‚

|å¤‰æ•°|èª¬æ˜|
| ----- | ----- |
|`ss`|2ã§ä½œæˆã—ãŸSpreadsheetã€‚`<Spreadsheetã®ID>`ã¯`https://docs.google.com/spreadsheets/d/<ã“ã®éƒ¨åˆ†>/edit`|
|`sheet`|2ã§ä½œæˆã—ãŸã‚·ãƒ¼ãƒˆ|
|`data`|`sheet`ã®ãƒ‡ãƒ¼ã‚¿ã‚’Arrayã§å–å¾—ã—ãŸã‚‚ã®|
|`columnNames`|`data`ã®1è¡Œç›®ã‚’å–ã‚Šå‡ºã—ãŸã‚‚ã®|
|`presentationId`|1ã§ä½œæˆã—ãŸSlidesã®IDã€‚`https://docs.google.com/presentation/d/<ã“ã®éƒ¨åˆ†>/edit#slide=id.p`|
|`folder`|ä½œæˆã—ãŸOGPç”»åƒã‚’æ ¼ç´ã—ã¦ãŠããŸã„Google Driveã®ãƒ•ã‚©ãƒ«ãƒ€ã€‚`<Folderã®ID>`ã¯`https://drive.google.com/drive/u/0/folders/<ã“ã®éƒ¨åˆ†>`ã€‚ã“ã®ãƒ•ã‚©ãƒ«ãƒ€ã¯å…¬é–‹è¨­å®šã«ã—ã¦ãŠãã¾ã™ï¼ˆå¾Œè¿°ï¼‰|

ã“ã®ã¨ãã€`data`ã¨`columnNames`ã¯ä»¥ä¸‹ã®ã‚ˆã†ã«ãªã£ã¦ã„ã¾ã™ã€‚

```js
data = [
  ['1', 'Test A', ''],
  ['2', 'Test B', ''],
  ['3', 'Test C', '']
]

columnNames = ['id', 'name', 'ogpId']
```

## 3-2. ç½®æ›ã—ã¦ç”»åƒä¿å­˜ã—ã¦ç½®æ›ã—ç›´ã™

```js
  data.forEach((row, index) => {
    const name = row[1]
    replaceText(presentationId, name)
    const ogpId = downloadImage(presentationId, `${index}.png`, folder)
    row[2] = ogpId
    resetText(presentationId, name)
  })
```

ã“ã“ãŒæ ¸ã§ã™ï¼ãªã«ã‹è‰²ã€…ã‚„ã£ã¦ã„ã‚‹ã‚ˆã†ã§ã™ãŒã€ã»ã¨ã‚“ã©ã®è¡Œã¯åˆ¥ã«ä½œæˆã—ãŸé–¢æ•°ã‚’å‘¼ã³å‡ºã—ã¦ã„ã‚‹ã®ã§ãã“ã‚‚èª¬æ˜ã—ã¦ã„ãã¾ã™ã€‚

ã¾ãšã€å…¨ä½“ã¯`data.forEach`ã§å›ã—ã¦ã„ã¾ã™ã€‚
æœ€åˆã«`row[1]`ã§ã€`Test A`, `Test B`, `Test C`ã‚’ãƒ«ãƒ¼ãƒ—ã”ã¨ã«`name`ã«æ ¼ç´ã—ã¦ã„ã¾ã™ã€‚
ãã‚Œã«ç¶šã„ã¦ã€

1. ã‚¹ãƒ©ã‚¤ãƒ‰ã®ãƒ†ã‚­ã‚¹ãƒˆã‚’`name`ã«ç½®æ›ï¼ˆ`replaceText()`ï¼‰
2. ã‚¹ãƒ©ã‚¤ãƒ‰ã‚’ã‚¤ãƒ¡ãƒ¼ã‚¸ä¿å­˜ï¼ˆ`downloadImage()`ï¼‰
3. ä¿å­˜ã—ãŸãƒ•ã‚¡ã‚¤ãƒ«ã®IDã‚’`data`ã«è¿½åŠ ï¼ˆ`row[2] = ogpId`ï¼‰
4. ã‚¹ãƒ©ã‚¤ãƒ‰ã®ãƒ†ã‚­ã‚¹ãƒˆã‚’ç½®æ›ã—ç›´ã™ï¼ˆ`resetText()`ï¼‰

ã¨å‡¦ç†ã‚’æµã—ã¦ã„ã¾ã™ã€‚

### 3-2-1. ã‚¹ãƒ©ã‚¤ãƒ‰ã®ãƒ†ã‚­ã‚¹ãƒˆã‚’ç½®æ›

ã‚¹ãƒ©ã‚¤ãƒ‰ã®ãƒ†ã‚­ã‚¹ãƒˆã®ç½®æ›å‡¦ç†ã‚’è¡Œã†`replaceText()`é–¢æ•°ã‚’å®šç¾©ã—ã¾ã—ãŸã€‚

```js
function replaceText(presentationId, name) {
  const presentation = SlidesApp.openById(presentationId)
  const slide = presentation.getSlides()[0]
  slide.replaceAllText('name', name)
  presentation.saveAndClose()  
}
```
å¼•æ•°ã¯`presentationId`ã¨ã€ç½®æ›å¾Œã®æ–‡å­—åˆ—`name`ã§ã™ã€‚
ã¾ãšã€`SlidesApp.openById(presentationId)`ã§ç½®æ›ã—ãŸã„ã‚¹ãƒ©ã‚¤ãƒ‰ãŒã‚ã‚‹Slidesã‚’é–‹ãã¾ã™ã€‚
ãã—ã¦ã€`getSlides()[0]`ã‚’ä½¿ã£ã¦ã€ãã®Slidesã®1æšç›®ã®ã‚¹ãƒ©ã‚¤ãƒ‰ã‚’å–å¾—ã—ã¾ã™ã€‚
ãã®`slide`ã«å¯¾ã—ã¦`replaceAllText()`ã‚’å®Ÿè¡Œã™ã‚‹ã“ã¨ã§ã€`slide`ã®ä¸­ã®`'name'`ã®æ–‡å­—åˆ—ã‚’å¼•æ•°ã®`name`ã«ç½®æ›ã—ã¦ã„ã¾ã™ã€‚
æœ€å¾Œã«`presentation.saveAndClose()`ã§ç½®æ›ã‚’ç¢ºå®šã—ã¦ã„ã¾ã™ã€‚`saveAndClose()`ã‚’è¡Œã‚ãªã„ã¨ã€æ¬¡ã®ã‚¤ãƒ¡ãƒ¼ã‚¸ä¿å­˜ã§ç½®æ›å‰ã®çŠ¶æ…‹ã§ä¿å­˜ã•ã‚Œã¦ã—ã¾ã†ã®ã§è¦ãƒã‚§ãƒƒã‚¯ã§ã™ã€‚

ç½®æ›ã®å‡¦ç†ã¯ã“ã‚Œã ã‘ã§ã™ã€‚ç½®æ›ã—ãŸã„æ–‡å­—åˆ—ãŒè¤‡æ•°ã‚ã‚‹å ´åˆã§ã‚‚åŒã˜ã‚„ã‚Šæ–¹ã§`slide.replaceAllText()`ã‚’è¿½åŠ ã™ã‚Œã°ã§ãã¾ã™ã—ã€è¤‡æ•°ã®ã‚¹ãƒ©ã‚¤ãƒ‰ã«å¯¾ã—ã¦ã‚„ã‚ŠãŸã„å ´åˆã¯`presentation`ã«å¯¾ã—ã¦`replaceAllText()`ã—ãŸã‚Šã€`getSlides()`ã®çµæœã‚’`forEach`ã§å›ã—ã¦ã‚¹ãƒ©ã‚¤ãƒ‰1æšãšã¤ã«å‡¦ç†ã™ã‚‹ã“ã¨ã§å®Ÿç¾ã§ãã¾ã™ã­ã€‚

### 3-2-2. ã‚¹ãƒ©ã‚¤ãƒ‰ã‚’ä¿å­˜
ã“ã‚Œã§å‹•çš„OGPã®ã‚¤ãƒ¡ãƒ¼ã‚¸ã®æº–å‚™ãŒã§ããŸã®ã§ã€ã“ã‚Œã‚’ã‚¤ãƒ¡ãƒ¼ã‚¸ãƒ•ã‚¡ã‚¤ãƒ«ã«ä¿å­˜ã—ã¾ã™ã€‚ä»Šå›ã¯`png`ã§ã€‚

```js
function downloadImage(presentationId, fileName, folder) {
  const presentation = SlidesApp.openById(presentationId)
  const slide = presentation.getSlides()[0]
  const slideId = slide.getObjectId()
  const url = `https://docs.google.com/presentation/d/${presentationId}/export/png?id=${presentationId}&pageId=${slideId}`
  const options = {
    headers: {
      Authorization: `Bearer ${ScriptApp.getOAuthToken()}`
    }
  }

  const response = UrlFetchApp.fetch(url, options)
  const image = response.getAs(MimeType.PNG)
  image.setName(fileName)
  const file = folder.createFile(image)
  return file.getId()
}
```
ä½•ã‚’ã™ã‚‹ã‹ã¨ã„ã†ã¨ã€Slidesã‚’ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ã™ã‚‹URLã«ãƒªã‚¯ã‚¨ã‚¹ãƒˆã‚’æŠ•ã’ã¦ã€ãƒ¬ã‚¹ãƒãƒ³ã‚¹ã‚’pngãƒ•ã‚¡ã‚¤ãƒ«ã«ã—ã¦ä¿å­˜ã—ã‚ˆã†ã¨ã„ã†ã‚„ã‚Šæ–¹ã§ã™ã€‚

å¼•æ•°ã¯ã€`presentationId`ã¨`folder`ã€ãã—ã¦ãƒ•ã‚¡ã‚¤ãƒ«åã¨ã—ã¦`fileName`ã‚’å–ã‚Šã¾ã™ã€‚
æœ€åˆã®`presentation`ã¨`slide`ã®å¼ã¯`replaceText()`ã¨åŒã˜ãªã®ã§èª¬æ˜ã¯çœç•¥ã—ã¾ã™ã€‚
`slideId`ã¯ãã®ã‚¹ãƒ©ã‚¤ãƒ‰ã®IDã®ã“ã¨ã§ã€`https://docs.google.com/presentation/d/<presentationId>/edit#slide=id.<'ã“ã®éƒ¨åˆ†'>`ã§ã™ã€‚ã“ã‚Œã¯`slide.getObjectId()`ã§å–å¾—ãŒã§ãã¾ã™ã€‚

ã“ã‚Œã‚‰ã®å¤‰æ•°ã‚’ä½¿ã£ã¦ãƒªã‚¯ã‚¨ã‚¹ãƒˆURL`url`ã‚’ä½œã‚Šã¾ã™ã€‚
ãƒªã‚¯ã‚¨ã‚¹ãƒˆã«ã¯èªè¨¼ãŒå¿…è¦ãªã®ã§ã€`ScriptApp.getOAuthToken()`ã‚’ä½¿ã£ã¦Bearerèªè¨¼ã§ãã‚‹ã‚ˆã†ã«`options`ã‚’ä½œã£ã¦ãŠãã¾ã™ã€‚

ã“ã®`url`ã¨`options`ã‚’ä½¿ã£ã¦ã€`UrlFetchApp.fetch()`ã§ãƒªã‚¯ã‚¨ã‚¹ãƒˆã‚’æŠ•ã’ã€ãƒ¬ã‚¹ãƒãƒ³ã‚¹ã‚’`response`ã«æ ¼ç´ã—ã¦ã„ã¾ã™ã€‚
`response`ã¯`HTTPResponse`ã¨ã„ã†Classã«ãªã£ã¦ã„ã‚‹ã®ã§ã€ç”»åƒãƒ•ã‚¡ã‚¤ãƒ«ã¨ã—ã¦æ‰±ãˆã‚‹ã‚ˆã†ã«`getAs(MimeType.PNG)`ã§pngãƒ•ã‚¡ã‚¤ãƒ«ã«å¤‰æ›ã—ã€`setName()`ã§ãƒ•ã‚¡ã‚¤ãƒ«åã‚’è¨­å®šã—ã¾ã—ãŸã€‚
ãã‚Œã‚’ã€`folder.createFile()`ã§`folder`ã«ãƒ•ã‚¡ã‚¤ãƒ«ã¨ã—ã¦ä¿å­˜ã—ã¦ã„ã‚‹ã£ã¦æµã‚Œã§ã™ã€‚
æœ€å¾Œã«ã€ä¿å­˜ã—ãŸãƒ•ã‚¡ã‚¤ãƒ«`file`ã®IDã‚’`getId()`ã§å–å¾—ã—ã¦ã€è¿”ã‚Šå€¤ã«ã—ã¦ã„ã¾ã™ã€‚

### 3-2-3. ä¿å­˜ã—ãŸãƒ•ã‚¡ã‚¤ãƒ«ã®IDã‚’ãƒ‡ãƒ¼ã‚¿ã«è¿½åŠ 
```js
const ogpId = downloadImage(presentationId, `${index}.png`, folder)
row[2] = ogpId
```
å…ˆç¨‹èª¬æ˜ã—ãŸã‚ˆã†ã«`downloadImage()`ã¯ä½œæˆã—ãŸpngãƒ•ã‚¡ã‚¤ãƒ«ã®IDã‚’returnã—ã¦ã¾ã™ã€‚
ãã‚Œã‚’`row[2]`ã€ã¤ã¾ã‚Š`ogpId`ã®ã‚«ãƒ©ãƒ ã«è¨­å®šã—ã¦ã„ã¾ã™ã€‚
è©³ã—ãã¯å¾Œã»ã©ç´¹ä»‹ã—ã¾ã™ãŒã€ã“ã‚ŒãŒNuxtã‚¢ãƒ—ãƒªã§Google Driveã®ç”»åƒãƒ•ã‚¡ã‚¤ãƒ«ã‚’OGPã«è¨­å®šã™ã‚‹è‚ã ã£ãŸã‚Šã—ã¾ã™ã€‚

### 3-2-4. ã‚¹ãƒ©ã‚¤ãƒ‰ã®ãƒ†ã‚­ã‚¹ãƒˆã‚’ç½®æ›ã—ç›´ã™
ã“ã“ã¾ã§çµ‚ã‚ã£ãŸã‚‰æ¬¡ã®ãƒ«ãƒ¼ãƒ—ã®ãŸã‚ã«ã‚¹ãƒ©ã‚¤ãƒ‰ã®æ–‡å­—åˆ—ã‚’å…ƒã®`'name'`ã«æˆ»ã—ã¦ãŠãã¾ã™ã€‚ã“ã®ãŸã‚ã«`resetText()`ã®é–¢æ•°ã‚’ç”¨æ„ã—ã¦å‘¼ã³å‡ºã—ã¦ã„ã¾ã™ã€‚

```js
function resetText(presentationId, name) {
  const presentation = SlidesApp.openById(presentationId)
  const slide = presentation.getSlides()[0]
  slide.replaceAllText(name, 'name')
  presentation.saveAndClose()
}
```
ã‚„ã£ã¦ã„ã‚‹ã“ã¨ã¯`replaceText()`ã®é€†ãªã®ã§èª¬æ˜ã¯çœç•¥ï¼

## 3-3. ã‚¹ãƒ—ãƒ¬ãƒƒãƒ‰ã‚·ãƒ¼ãƒˆã®ogpIdã‚’æ›´æ–°
```js
data.unshift(columnNames)
sheet.getRange(1, 1, data.length, data[0].length).setValues(data)
```
æœ€å¾Œã«Spreadsheetã®ogpIdã‚«ãƒ©ãƒ ã‚’æ›´æ–°ã—ã¾ã—ã‚‡ã†ã€‚
ã™ã§ã«ã“ã“ã¾ã§ã®å‡¦ç†ã§`data`ã®å„Arrayè¦ç´ ã®3ã¤ç›®ã®è¦ç´ ã«`ogpId`ãŒæ ¼ç´ã•ã‚Œã¦ã„ã‚‹ã®ã§ã€Spreadsheetã‚’ä¸Šæ›¸ãã™ã‚Œã°OKã§ã™ã­ã€‚

ã¨ã„ã†ã“ã¨ã§ã€`data.unshift(columnNames)`ã§`data`ã®1ã¤ç›®ã®è¦ç´ ã«åˆ—ã®åå‰ã‚’æˆ»ã—ã¦ã€
`sheet.getRange().setValues()`ã§ãƒ‡ãƒ¼ã‚¿ã‚’ä¸Šæ›¸ãã—ã¦ã„ã¾ã™ã€‚

ã“ã“ã¾ã§ã§ç”»åƒã‚’ä½œæˆã™ã‚‹ã‚¹ãƒ†ãƒƒãƒ—ãŒå®Œäº†ã§ã™ã€‚ğŸ˜Š
ã“ã“ã‹ã‚‰ã¯Spreadsheetã‚’ã‚‚ã¨ã«Nuxtã‚¢ãƒ—ãƒªã§OGPç”»åƒã‚’å‹•çš„ã«è¨­å®šã—ã¦ã¿ã¾ã—ã‚‡ã†ï¼

# 4. Spreadsheetã‚’WebAppï¼ˆAPIï¼‰ã§å…¬é–‹
æ¬¡ã¯å…ˆç¨‹OGPã®IDã‚’è¿½è¨˜ã—ãŸSpreadsheetã‚’WebAppã§å…¬é–‹ã—ã¦ã„ãã¾ã™ã€‚
ã“ã®ã‚„ã‚Šæ–¹ã¯ã€ä»¥å‰ã«è¨˜äº‹ã‚’æ›¸ã„ãŸã®ã§è©³ç´°ã¯ãã¡ã‚‰ã‚’è¦‹ã¦ãã ã•ã„ï¼

[Nuxt ã§ Google Spreadsheet ã‚’ DB ä»£ã‚ã‚Šã«ä½¿ã†ãå¤§ä½œæˆ¦](/blog/20210926-operation-to-use-google-spreadsheet-as-a-db-with-nuxt)

GASã®ã‚³ãƒ¼ãƒ‰ã¯ä»¥ä¸‹ã®ã‚ˆã†ã«ãªã‚Šã¾ã™ã€‚å…ˆç¨‹ã®`ã‚³ãƒ¼ãƒ‰.js`ã«è¿½è¨˜ã—ã¦ã„ãã¾ã—ã‚‡ã†ã€‚

```js:ã‚³ãƒ¼ãƒ‰.js
...
function doGet() {
  const users = getUsers()
  return ContentService
          .createTextOutput(JSON.stringify(users))
          .setMimeType(ContentService.MimeType.JSON)
}

function getUsers() {
  const ss = SpreadsheetApp.openById('<Spreadsheetã®ID>')
  const sheet = ss.getSheetByName('<ã‚·ãƒ¼ãƒˆå>')
  const table = sheet.getDataRange().getValues()
  const keys = table.shift()

  const users = table.map((row) => {
    const object = {}
    row.map((value, index) => {
      object[String(keys[index])] = String(value)
    })
    return object
  })

  return users
}
```
ã“ã‚Œã‚’ã€ãƒ‡ãƒ—ãƒ­ã‚¤ã—ã¦WebAppå…¬é–‹ã—ã¾ã—ã‚‡ãƒ¼ã€‚

# 5. Nuxtã‚¢ãƒ—ãƒªã§å‹•çš„OGPã‚’è¨­å®š
ã¾ãšã¯ã€Nuxtã‚¢ãƒ—ãƒªã§å…ˆç¨‹å…¬é–‹ã—ãŸWebAppã«ãƒªã‚¯ã‚¨ã‚¹ãƒˆã™ã‚‹ä¸‹æº–å‚™ã‚’ã—ã¾ã™ã€‚ä»Šå›ã¯`axios`ã‚’ä½¿ã†ã“ã¨ã‚’å‰æã¨ã—ã¦ã€`serverMiddleware`çµŒç”±ã§WebAppã‚’å‘¼ã³å‡ºã—ã¾ã™ã€‚
ã“ã¡ã‚‰ã‚‚éå»ã«è¨˜äº‹ã‚’æ›¸ã„ã¦ã„ã¾ã™ã®ã§ã€è©³ç´°ã«ã¤ã„ã¦ã¯ãã¡ã‚‰ã‚’å‚ç…§ã—ã¦ãã ã•ã„ã€‚

[Nuxtã§ã‚¹ãƒ—ãƒ¬ãƒƒãƒ‰ã‚·ãƒ¼ãƒˆã‚’DBä»£ã‚ã‚Šã«ä½¿ã†ãå¤§ä½œæˆ¦ Part3 - asyncDataã§ã ã£ã¦ä½¿ã„ãŸã„ï¼](/blog/20211001-operation-to-use-google-spreadsheet-as-a-db-with-nuxt3)

ä»¥ä¸‹ã®æ›´æ–°ã€ã‚‚ã—ãã¯æ–°è¦ä½œæˆã‚’è¡Œã„ã¾ã™ã€‚

```js:nuxt.config.js ins={3-8}
export default {
  ...
  axios: {
    proxy: true,
  },
  serverMiddleware: [
    '@api/'
  ],
  ...
}
```

```js:api/index.js
const express = require('express')
const axios = require('axios')
const app = express()

app.get('/', async (req, res) => {
  const response = axios.get('<WebAppã®URL>')
  res.send(response.data)
})

module.exports = {
  path: '/api/',
  handler: app,
}
```

ã“ã‚Œã§ä¸‹æº–å‚™ãŒå®Œäº†ã§ã™ã€‚ã‚ã¨ã¯`pages`ã®ãƒ•ã‚¡ã‚¤ãƒ«ã§`asyncData()`ã§æƒ…å ±å–å¾—ã—ã¦ã€`head()`ã§ç”»åƒã®ãƒ‘ã‚¹ã‚’æŒ‡å®šã—ã¦ã‚ã’ã‚‹ã ã‘ã§ã™ã€‚

ä»Šå›ã¯`pages/index.vue`ã§ã‚¯ã‚¨ãƒªãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ãƒ¼`id`ã«å¿œã˜ã¦OGPç”»åƒã‚’å‡ºã—å…¥ã‚Œã—ã¾ã—ã‚‡ã†ã€‚ãƒ‘ã‚¹ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ãƒ¼ã¨ã‹ã§ã‚‚ã‚„ã‚Šæ–¹ã¯åŸºæœ¬çš„ã«å¤‰ã‚ã‚Šãªã„ã§ã™ã€‚

```vue:pages/index.vue
...
<script>
export default {
  async asyncData({ $axios, query }) {
    const users = await $axios.$get('/api')
    const user = query.id ? users.find((user) => user.id === query.id) : null
    const ogpUrl = user ? `https://drive.google.com/uc?export=view&id=${user.ogpId}` : <å…±é€šã®OGPã‚¤ãƒ¡ãƒ¼ã‚¸ã®ãƒ‘ã‚¹>

    return {
      users: users,
      ogpUrl: ogpUrl
    }
  },

  head() {
    return {
      meta: [
        {
          hid: 'og:image',
          property: 'og:image',
          content: this.ogpUrl
        }
      ]
    }
  }
}
</script>
...
```

ä¾‹ãˆã°ã“ã‚“ãªæ„Ÿã˜ã€‚ï¼ˆ`nuxt.config.js`ã§ä»–ã®ã‚¿ã‚°ã¯è¨­å®šã•ã‚Œã¦ã„ã‚‹å‰æã§ã™ï¼ï¼‰
`asyncData`ã§ã‚¯ã‚¨ãƒªãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ãƒ¼`id`ãŒå­˜åœ¨ã™ã‚‹å ´åˆã¯ã€`users`ã‹ã‚‰åŒã˜`id`ã®`user`ã‚’æ¢ã—ã¦ã¾ã™ã€‚
è¦‹ã¤ã‹ã£ãŸã‚‰`ogpUrl`ã«`https://drive.google.com/uc?export=view&id=${user.ogpId}`ã‚’ã€å­˜åœ¨ã—ãªã„å ´åˆã¯\<å…±é€šã®OGPã‚¤ãƒ¡ãƒ¼ã‚¸ã®ãƒ‘ã‚¹\>ã‚’ã‚»ãƒƒãƒˆã—ã€`head()`ã§`og:image`ã®`property`ã¨ã—ã¦`ogpUrl`ã‚’è¨­å®šã—ã¦ã„ã¾ã™ã€‚
ã“ã†ã™ã‚‹ã“ã¨ã§ã‚¯ã‚¨ãƒªãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ãƒ¼`id`ã«å¿œã˜ã¦å‹•çš„ã«OGPã‚’è¨­å®šã™ã‚‹ã“ã¨ãŒã§ãã¾ã™ã€‚

ã•ã¦ã€ã“ã“ã§å‡ºã¦ããŸ`https://drive.google.com/uc?export=view&id=`ã§ã™ã€‚
Google Driveä¸Šã§ç”»åƒãƒ•ã‚¡ã‚¤ãƒ«ã‚’è¦‹ã‚ˆã†ã¨ã™ã‚‹ã¨ãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼ãƒ¢ãƒ¼ãƒ‰ã§è¡¨ç¤ºã•ã‚Œã‚‹ã¨æ€ã„ã¾ã™ã€‚ã“ã®çŠ¶æ…‹ã§ã¯ã‚³ãƒ¼ãƒ‰ã‹ã‚‰ã™ã‚Œã°ç”»åƒãƒ•ã‚¡ã‚¤ãƒ«ã¨ã—ã¦æ‰±ã†ã“ã¨ãŒã§ãã¾ã›ã‚“ã€‚
å®Ÿã¯`https://drive.google.com/uc?export=view&id=<è¡¨ç¤ºã—ãŸã„ç”»åƒãƒ•ã‚¡ã‚¤ãƒ«ã®ID>`ã§ã‚ã‚Œã°ã€ãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼ãƒ¢ãƒ¼ãƒ‰ã§ã¯ãªãç”»åƒãƒ•ã‚¡ã‚¤ãƒ«ã¨ã—ã¦èªè­˜ã•ã›ã‚‹ã“ã¨ãŒã§ãã¾ã™ã€‚
ã¾ãŸã€ã“ã‚Œã§è¡¨ç¤ºã§ãã‚‹ã®ã¯é–²è¦§æ¨©é™ã‚’ã‚‚ã¤ãƒ¦ãƒ¼ã‚¶ãƒ¼ã®ã¿ã§ã™ã®ã§ã€OGPç”»åƒã‚’ä¿å­˜ã—ã¦ã„ã‚‹ãƒ•ã‚©ãƒ«ãƒ€ã¯ã™ã¹ã¦ã®ãƒ¦ãƒ¼ã‚¶ãƒ¼ã«é–²è¦§æ¨©é™ã§å…¬é–‹ã•ã‚Œã¦ã„ã‚‹å¿…è¦ãŒã‚ã‚Šã¾ã™ã€‚

[ngrok](https://ngrok.com/)ã§å…¬é–‹ã—ã€[Twitter Card Validator](https://cards-dev.twitter.com/validator)ã§OGPãŒæ­£ã—ãè¨­å®šã•ã‚Œã¦ã„ã‚‹ã‹ç¢ºèªã—ã¦ã¿ã¾ã—ã‚‡ã†ã€‚

## id=1ã®ã¨ã
![id=1ã®ã¨ã](./images/2_twitter_card_validator_1.png)

## id=2ã®ã¨ã
![id=2ã®ã¨ã](./images/3_twitter_card_validator_2.png)

å‹•çš„ã«OGPç”»åƒãŒè¡¨ç¤ºã•ã‚Œã¦ã‚‹ã“ã¨ã‚’ç¢ºèªã§ãã¾ã—ãŸï¼

# ã¾ã¨ã‚
é•·ããªã£ã¦ã—ã¾ã„ã¾ã—ãŸãŒã€ã“ã‚Œã§Spreadsheetã¨Slidesã‚’ä½¿ã£ã¦OGPç”»åƒã‚’ç”Ÿæˆã—Nuxtã‚¢ãƒ—ãƒªã§å‹•çš„OGPã‚’å®Ÿç¾ã™ã‚‹ä¸€é€£ã®æµã‚Œã‚’ç´¹ä»‹ã•ã›ã¦ã„ãŸã ãã¾ã—ãŸã€‚
ã‹ãªã‚Šè‰²ã€…ãªã‚µã‚¤ãƒˆã‚’å‚è€ƒã«ã•ã›ã¦ã„ãŸã ã„ã¦ã“ã“ã¾ã§ã§ããŸã®ã§ã€ã“ã®å ´ã‚’å€Ÿã‚Šã¦ãŠç¤¼ã‚’ã€‚m(_ _)m
GASã€ã‹ãªã‚Šè‰²ã€…ãªã“ã¨ãŒã§ãã‚‹ã®ã§æ¥½ã—ã„ã§ã™ã­ã€‚

# å‚è€ƒ
- [Slides Service Â |Â  Apps Script Â |Â  Google Developers](https://developers.google.com/apps-script/reference/slides?hl=en)
- [Spreadsheet Service Â |Â  Apps Script Â |Â  Google Developers](https://developers.google.com/apps-script/reference/spreadsheet)
- [Drive Service Â |Â  Apps Script Â |Â  Google Developers](https://developers.google.com/apps-script/reference/drive)
- [[Google Apps Script]Googleã‚¹ãƒ©ã‚¤ãƒ‰ã®ãƒ—ãƒ¬ã‚¼ãƒ³ãƒ†ãƒ¼ã‚·ãƒ§ãƒ³ã‚’ä»–å½¢å¼ã«å¤‰æ›ã™ã‚‹ | åˆå¿ƒè€…å‚™å¿˜éŒ²](https://www.ka-net.org/blog/?p=12905)
- [Google ãƒ‰ãƒ©ã‚¤ãƒ–ã§ãƒ•ã‚¡ã‚¤ãƒ«åã¨ãƒªãƒ³ã‚¯ã®ä¸€è¦§ã‚’ãŠæ‰‹è»½ã«å–å¾—ã™ã‚‹æ–¹æ³• | DevelopersIO](https://dev.classmethod.jp/articles/gas-get-file-list-in-folder/)
- [Google Drive ã«ä¿å­˜ã—ãŸç”»åƒã‚’ç›´æ¥å‘¼ã³å‡ºã›ã‚‹URLã®å–å¾— - Qiita](https://qiita.com/codeDiver/items/0394968fa318d9309d33)