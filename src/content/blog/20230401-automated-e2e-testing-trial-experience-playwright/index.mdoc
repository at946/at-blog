---
title: è‡ªå‹•E2Eãƒ†ã‚¹ãƒˆãŠè©¦ã—ä½“é¨“è¨˜ï¼ˆPlaywrightï¼‰
tags: 
  - Playwright
  - E2Eãƒ†ã‚¹ãƒˆ
  - ãƒ†ã‚¹ãƒˆè‡ªå‹•åŒ–
publicationDate: '2023-04-01'
isPublished: true
---

å¾Œè¼©ãã‚“ã«ã€ŒE2Eãƒ†ã‚¹ãƒˆãªã‚“ã‹æ€–ã„ğŸ˜£ã€ã¨è¨€ã‚ã‚ŒãŸã®ã§ã€Œã‚½ãƒ³ãƒŠã‚³ãƒˆãƒŠã‚¤ãƒ¨ãƒ¼â˜€ã€ã‚’ä½“é¨“ã—ã¦ã‚‚ã‚‰ã†ãŸã‚ã«æ›¸ãã€‚

## Playwright
[Fast and reliable end-to-end testing for modern web apps | Playwright](https://playwright.dev/)

ã¨ã‚Šã‚ãˆãšã€ä»Šå›ã¯ã“ã®Playwrightã£ã¦ã‚„ã¤ã‚’ä½¿ã£ã¦ã¿ã‚ˆã†ã€‚
ã¾ãšã¯ã€Œãªã‚“ã‹æ€–ã„ã€ã‚’æ‰•æ‹­ã™ã‚‹ãŸã‚ã ã‹ã‚‰ç†ç”±ã¨ã‹ã¯è„‡ã«ãŠã„ã¦ãŠã“ã†ã€‚
ã§ã‚‚è»½å¿«ã ã—ã€ã‚¯ãƒ­ã‚¹ãƒ–ãƒ©ã‚¦ã‚¶ã§ãã‚‹ã—ã€ã‚¹ã‚¯ã‚·ãƒ§ã‚„ãƒ“ãƒ‡ã‚ªã‚‚å–ã‚Œã‚‹ã—ã€ã„ã„ãã€‚

## Playwrightã‚’ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«
Dockerä½¿ã£ã¦ããã€‚ã¾ãšã¯æº–å‚™ã ã€‚

```dockerfile:Dockerfile
FROM node:19.4
ENV WORKDIR=/playwright/

WORKDIR $WORKDIR
```

```yaml:docker-compose.yml
version: '3'

services:
  playwright:
    build: .
    volumes:
      - .:/playwright
```

```bash
$ docker compose build
```

ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã¯å…¬å¼ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆè¦‹ã¦ã“ã†ã€‚  
[Installation | Playwright](https://playwright.dev/docs/intro)

```bash
$ docker compose run playwright yarn create playwright

? Do you want to use TypeScript or JavaScript?
> TypeScript

? Where to put your end-to-end tests?
> tests

? Add a GitHub Actions workflow?
> N

? Install Playwright browsers (can be done manually via 'yarn playwright install')?
> n

? Install Playwright operating system dependencies (requires sudo / root - can be done manually via 'sudo yarn playwright install-deps')?
> n
```

ã„ã‚ã„ã‚ãªãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã‚„ãƒ•ã‚¡ã‚¤ãƒ«ãŒç”Ÿæˆã•ã‚Œã¦ã„ã‚‹ãªã€‚

```sh
.
â”œâ”€ node_modules/
|  â””â”€ çœç•¥
â”œâ”€ tests/
|  â””â”€ example.spec.ts
â”œâ”€ tests-examples/
|  â””â”€ demo-todo-app.spec.ts
â”œâ”€ .gitignore
â”œâ”€ docker-compose.yml
â”œâ”€ Dockerfile
â”œâ”€ package.json
â”œâ”€ playwright.config.ts
â””â”€ yarn.lock
```
ã“ã‚“ãªæ„Ÿã˜ã«ãªã£ã¦ã‚‹ã¯ãšã€‚

browsersã¨operating system dependenciesã¯ã»ã—ã„ã®ã§ã€`Dockerfile`ã«æ›¸ã„ã¦ã“ã†ã€‚

```dockerfile:Dockerfile ins={4-6}
  FROM node:19.4
  ENV WORKDIR=/playwright/

  WORKDIR $WORKDIR

+ COPY package.json $WORKDIR
+ COPY yarn.lock $WORKDIR
+ 
+ RUN yarn install
+ RUN yarn playwright install && yarn playwright install-deps
+ 
+ CMD ["yarn", "playwright", "test"]
```

`Dockerfile`ã„ã˜ã£ãŸã®ã§ã‚‚ã†ä¸€åº¦ãƒ“ãƒ«ãƒ‰ã—ã¦ãŠãã€‚

```bash
$ docker compose build
```

æº–å‚™ã¯ã“ã‚“ãªã¨ã“ã§OKã‹ãªã€‚

## ãƒ†ã‚¹ãƒˆã‚’å®Ÿè¡Œã—ã¦ã¿ã‚‹
æœ€åˆã‹ã‚‰`tests/sample.spec.ts`ã£ã¦ã‚µãƒ³ãƒ—ãƒ«ãƒ†ã‚¹ãƒˆã‚³ãƒ¼ãƒ‰ãŒã‚ã‚‹ã˜ã‚ƒãªã„ã‹ã€‚

```ts:tests/example.spec.ts
import { test, expect } from '@playwright/test';

test('has title', async ({ page }) => {
  await page.goto('https://playwright.dev/');

  // Expect a title "to contain" a substring.
  await expect(page).toHaveTitle(/Playwright/);
});

test('get started link', async ({ page }) => {
  await page.goto('https://playwright.dev/');

  // Click the get started link.
  await page.getByRole('link', { name: 'Get started' }).click();

  // Expects the URL to contain intro.
  await expect(page).toHaveURL(/.*intro/);
});
```
`test()`ã£ã¦ã®ãŒ2ã¤ã‚ã‚‹ã€‚ã“ã‚ŒãŒãƒ†ã‚¹ãƒˆã‚±ãƒ¼ã‚¹ã ãªã€‚
ãã®å¾Œã«`'has title'`ã€`'get started link'`ã£ã¦ãƒ†ã‚­ã‚¹ãƒˆãŒä»˜ã„ã¦ã‚‹ã‘ã©ã€ãƒ†ã‚¹ãƒˆã‚±ãƒ¼ã‚¹åã ã‚ã†ã€‚
ã‚³ãƒ¡ãƒ³ãƒˆã‚¢ã‚¦ãƒˆã§èª¬æ˜ã‚‚æ›¸ã‹ã‚Œã¦ã„ã‚‹ã‘ã©ã€ãªã‚“ã‹ã‚³ãƒ¼ãƒ‰ã‹ã‚‰ã‚ã‚‹ç¨‹åº¦ã‚ã‹ã‚Šãã†ã ãªã€‚

### has title
`page.goto()`ã§æ‹¬å¼§å†…ã®URLã«ã‚¢ã‚¯ã‚»ã‚¹ã—ã¦ãã†ã€‚
`page.goto('https://playwright.dev/')`ã¯ https://playwright.dev/ ã«ã‚¢ã‚¯ã‚»ã‚¹ã—ã¦ã‚‹ã‚“ã ã‚ã†ã€‚

`expect(page).xxx`ã§ä½•ã‹ã‚’æ¤œè¨¼ã—ã¦ã„ãã†ã ãªã€‚
ä¾‹ãˆã°`expect(page).toHaveTitle(/Playwright/)`ã¯ã€ãƒšãƒ¼ã‚¸ã®ã‚¿ã‚¤ãƒˆãƒ«ã«ã€ŒPlaywrightã€ãŒå«ã¾ã‚Œã¦ã„ã‚‹ã“ã¨ã‚’æ¤œè¨¼ã—ã¦ã„ãã†ã ã€‚
ã“ã®ãƒšãƒ¼ã‚¸ã®ã‚¿ã‚¤ãƒˆãƒ«ã¯ã€ŒFast and reliable end-to-end testing for modern web apps | Playwrightã€ã¿ãŸã„ã ã‹ã‚‰ãƒ‘ã‚¹ã—ãã†ã€‚

### get started link
`page.goto('https://playwright.dev/')`ã¯`has title`ã®ãƒ†ã‚¹ãƒˆã¨åŒã˜ã ã€‚

`page.getByRole('link', { name: 'Get started' }).click()`ã¯ã€ã€ŒGet strtedã€ã£ã¦ãƒ†ã‚­ã‚¹ãƒˆã‚’æŒã¤ãƒªãƒ³ã‚¯ã‚’ã‚¯ãƒªãƒƒã‚¯ã—ã¦ã„ã‚‹ã‚“ã ã‚ã†ã€‚ãƒšãƒ¼ã‚¸ãƒˆãƒƒãƒ—ã«ã‚ã‚‹ãƒœã‚¿ãƒ³ã ãªã€‚

`expect(page).toHaveURL(/.*intro/)`ã§URLãŒ`intro`ã§çµ‚ã‚ã‚‹ã‹è¦‹ã¦ã‚‹ãªã€‚
å®Ÿéš›é·ç§»å…ˆã®URLã¯`https://playwright.dev/docs/intro`ã ã‹ã‚‰ã“ã‚Œã‚‚ãƒ‘ã‚¹ã—ãã†ã€‚

ã“ã‚Œã‚’å›ã—ã¦ã¿ã‚ˆã†ã€‚

```bash
$ docker compose up
6 passed
```
ãƒ‘ã‚¹ã—ãŸã€‚
ã¡ãªã¿ã«`tests/sample.spec.ts`ã«ã¯`test()`ã¯2ã¤ã—ã‹ãªã„ã‘ã©6ã¤ã®ãƒ†ã‚¹ãƒˆãŒãƒ‘ã‚¹ã—ã¦ã‚‹ã€‚
ãã—ã¦ã‚³ãƒ³ã‚½ãƒ¼ãƒ«ã‚’çœºã‚ã¦ã‚‹ã¨`[chromium]`,`[firefox]`,`[webkit]`ã®æ–‡å­—ãŒè¦‹ãˆãŸã€‚
ãã†ã€ã™ã§ã«ã‚¯ãƒ­ã‚¹ãƒ–ãƒ©ã‚¦ã‚¶ã§ãƒ†ã‚¹ãƒˆã—ã¦ã‚„ãŒã‚‹ã€‚ã‚„ã‚Šã‚„ãŒã‚‹ã€‚

ã“ã®è¾ºã¯ã€`playwright.config.ts`ã‚’çœºã‚ã‚‹ã¨ãªã‚“ã¨ãªãã‚ã‹ã‚‹ã€‚

```ts:playwright.config.ts
...
export default defaultConfig({
  testDir: './tests',
  ...
  projects: [
    {
      name: 'chromium',
      use: { ...devices['Desktop Chrome'] },
    },

    {
      name: 'firefox',
      use: { ...devices['Desktop Firefox'] },
    },

    {
      name: 'webkit',
      use: { ...devices['Desktop Safari'] },
    },


    /* Test against mobile viewports. */
    // {
    //   name: 'Mobile Chrome',
    //   use: { ...devices['Pixel 5'] },
    // },
    // {
    //   name: 'Mobile Safari',
    //   use: { ...devices['iPhone 12'] },
    // },

    /* Test against branded browsers. */
    // {
    //   name: 'Microsoft Edge',
    //   use: { ...devices['Desktop Edge'], channel: 'msedge' },
    // },
    // {
    //   name: 'Google Chrome',
    //   use: { ..devices['Desktop Chrome'], channel: 'chrome' },
    // },
  ],
  ...
})
```
Desktopã®Chromeã€Firefoxã€Saferiã§ãƒ†ã‚¹ãƒˆã—ãŸã‚ˆã†ã ã€‚
ãã—ã¦ã‚³ãƒ¡ãƒ³ãƒˆã‚¢ã‚¦ãƒˆã«ã•ã‚‰ãªã‚‹å¤¢ã‚’æ„Ÿã˜ã‚‹ã€‚

## ãƒ†ã‚¹ãƒˆã‚’æ›¸ã„ã¦ã¿ã‚‹
è‡ªåˆ†ã§ã‚‚ãƒ†ã‚¹ãƒˆã‚’è¿½åŠ ã—ã¦ã¿ãŸã„ã€‚

[Writing tests | Playwright](https://playwright.dev/docs/writing-tests)

å…¬å¼ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆãŒä¸å¯§ã€‚

[https://playwright.dev/](https://playwright.dev/) ã«ã¯ãƒšãƒ¼ã‚¸ãƒˆãƒƒãƒ—ã«ã€ŒPlaywright enables reliable end-to-end testing for modern web apps.ã€ã£ã¦ãƒ’ãƒ¼ãƒ­ãƒ¼ã‚¿ã‚¤ãƒˆãƒ«ãŒã‚ã‚‹ã€‚ã“ã‚Œã‚’æ¤œè¨¼ã—ã¦ã¿ã‚ˆã†ã€‚


```ts:tests/example.spec.ts
...

test('has hero title', async ({ page }) => {
  await page.goto('https://playwright.dev/')

  await expect(page.getByRole('heading', { name: 'Playwright enables reliable end-to-end testing for modern web apps.' })).toBeVisible()
})
...
```
è¦ç´ ã¯Locatorsã¨ã„ã†ã‚‚ã®ã§æŒ‡å®šã™ã‚‹ã‚‰ã—ã„ï¼ˆ`page.getByRole('header', { name: xxx })`ã®ã¨ã“ï¼‰ã€‚
`toBeVisible()`ã§å­˜åœ¨ã—ã¦ã„ã‚‹ã“ã¨ï¼ˆè¦‹ãˆã¦ã„ã‚‹ã“ã¨ï¼‰ã‚’æ¤œè¨¼ã—ã¦ã„ã‚‹ã€‚
è©³ã—ãã¯ã€å…¬å¼ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã‚’å‚ç…§ã€‚

[Locators | Playwright (Locale by role)](https://playwright.dev/docs/locators#locate-by-role)

ã¡ãªã¿ã«`class`ã‚’ä½¿ã£ãŸã‚Šã—ã¦æŒ‡å®šã‚‚ã§ãã‚‹ã€‚

```ts:tests/example.spec.ts
...

test('has hero title', async ({ page }) => {
  await page.goto('https://playwright.dev/')

  await expect(page.locator('.hero__title')).toHaveText('Playwright enables reliable end-to-end testing for modern web apps.')
})
...
```

```bash
$ docker compose up
9 passed
```
ã©ã¡ã‚‰ã®æ›¸ãæ–¹ã«ã›ã‚ˆã€9ã¤ã®ãƒ†ã‚¹ãƒˆãŒãƒ‘ã‚¹ã—ãŸã¯ãšã€‚

ãŠã‰...ãªã‚“ã‹ã“ã‚“ãªæ„Ÿã˜ã§ãªã‚“ã ã£ã¦ã§ããã†ã ãª..ã€‚

Locatorã«å¯¾ã™ã‚‹æ“ä½œã‚‚ã„ã‚ã„ã‚..ã€‚

[Locator | Playwright](https://playwright.dev/docs/api/class-locator)

Assertionã‚‚è‰²ã€…..ã€‚

[PageAssertions | Playwright](https://playwright.dev/docs/api/class-pageassertions)

[LocatorAssertions | Playwright](https://playwright.dev/docs/api/class-locatorassertions)

ã“ã‚Œã€ãªã‚“ã§ã‚‚ã§ãã‚‹ã‚“ã˜ã‚ƒãªã„ã®...??

## å¤±æ•—ã‚‚è¦‹ã¨ã
ã¡ã‚ƒã‚“ã¨å¤±æ•—ã™ã‚‹ã®ã‹ã‚‚è¦‹ã¦ãŠã“ã†ã€‚

```ts:tests/example.spec.ts
  ...

  test('has hero title', async ({ page }) => {
    await page.goto('https://playwright.dev/')

-   await expect(page.getByRole('heading', { name: 'Playwright enables reliable end-to-end testing for modern web apps.' })).toBeVisible()
+   await expect(page.getByRole('heading', { name: 'Playwright enables reliable end-to-end testing for modern web apps.' })).not.toBeVisible()
  })
...
```
`.toBeVisible()`ã®å‰ã«`.not`ã‚’ã¤ã‘ãŸã€‚ã“ã‚Œã§ã€Œå­˜åœ¨ã—ãªã„ï¼ˆè¦‹ãˆãªã„ï¼‰ã€ã“ã¨ã‚’æ¤œè¨¼ã™ã‚‹ã“ã¨ã«ãªã‚‹ã€‚
ã§ã‚‚å®Ÿéš›ã¯ã‚ã‚‹ã‹ã‚‰å¤±æ•—ã™ã‚‹ã¯ãšã€‚

```bash
$ docker compose up
3 failed
[chromium] â€º example.spec.ts:20:5 â€º has hero title
[firefox] â€º example.spec.ts:20:5 â€º has hero title
[webkit] â€º example.spec.ts:20:5 â€º has hero title
6 passed
```
3ã¤å¤±æ•—ã—ã¦ã‚‹ã€‚æœŸå¾…é€šã‚Šã€‚

ã¡ãªã¿ã«playwrightã¯ãƒ†ã‚¹ãƒˆã®ãƒ¬ãƒãƒ¼ãƒˆã‚‚ä½œã£ã¦ãã‚Œã‚‹ã€‚
`playwright-report/index.html`ã¨ã„ã†ãƒ•ã‚¡ã‚¤ãƒ«ãŒç”Ÿæˆã•ã‚Œã¦ã„ã‚‹ã®ã§ã€ãƒ–ãƒ©ã‚¦ã‚¶ã§é–‹ã„ã¦è¦‹ã¦ã¿ã‚ˆã†ã€‚

![ãƒ†ã‚¹ãƒˆãƒ¬ãƒãƒ¼ãƒˆ](./images/report.png)

ã†ã‚ãã€‚è¦‹ã‚„ã™ã„..ã€‚

![ãƒ†ã‚¹ãƒˆãƒ¬ãƒãƒ¼ãƒˆè©³ç´°](./images/report_detail.png)

è©³ç´°ã¾ã§è¦‹ã‚‰ã‚Œã‚‹ã‚“ã§ã™ã‹..ã€‚

## å¤±æ•—æ™‚ã®ã‚ªãƒ—ã‚·ãƒ§ãƒ³ã‚’å°‘ã—è¿½åŠ 
ã§ã‚‚å¤±æ•—æ™‚ã©ã†ã ã£ãŸã®ã‹ã€ã“ã®ãƒ¬ãƒãƒ¼ãƒˆã‹ã‚‰ã§ã¯ã‚ã‹ã‚‰ãªã„ã€‚
ã¨æ€ã£ãŸã‚‰ãƒ†ã‚¹ãƒˆã‚ªãƒ—ã‚·ãƒ§ãƒ³ãŒã‚ã£ã¡ã‚ƒè±Šå¯Œã€‚

[https://playwright.dev/docs/api/class-testoptions](https://playwright.dev/docs/api/class-testoptions)

```ts:playwright.config.ts
  import { defineConfig, devices } from '@playwright/test';
  ...
  export default defineConfig({
    testDir: './tests',
    ...
    use: {
      trace: 'on-first-retry',
+     screenshot: {
+       mode: 'only-on-failure',
+       fullPage: true,
+     },
+     video: 'retain-on-failure',
    },
    ...
  });
```

å¤±æ•—æ™‚ã«ã‚¹ã‚¯ãƒªãƒ¼ãƒ³ã‚·ãƒ§ãƒƒãƒˆã¨ãƒ“ãƒ‡ã‚ªã‚’æ’®ã‚‹ã“ã¨ã«ã—ã¦ã¿ãŸã€‚
ã‚‚ã†ä¸€åº¦ãƒ†ã‚¹ãƒˆã‚’å¤±æ•—ã•ã›ã¦ã€ãƒ¬ãƒãƒ¼ãƒˆã‚’è¦‹ã‚‹ã¨..ã€‚

![ãƒ†ã‚¹ãƒˆãƒ¬ãƒãƒ¼ãƒˆè©³ç´°ï¼ˆã‚¹ã‚¯ãƒªãƒ¼ãƒ³ã‚·ãƒ§ãƒƒãƒˆï¼‰](./images/report_screenshot.png)

![ãƒ†ã‚¹ãƒˆãƒ¬ãƒãƒ¼ãƒˆè©³ç´°ï¼ˆãƒ“ãƒ‡ã‚ªï¼‰](./images/report_video.png)

ä¾¿åˆ©ã™ãï¼

## æ€–ããªã„ã‚ˆã­ï¼Ÿ
ã¨ã„ã†ã“ã¨ã§ã€æ€–ããªã‹ã£ãŸã‚ˆã­ï¼Ÿ
ã‚€ã—ã‚ã‚ã£ã¡ã‚ƒå‘³æ–¹ã€‚é ¼ã‚Œã‚‹ã‚„ã¤ã‚„E2Eã€‚Playwrightã™ã’ã‡ã€‚
å…¬å¼ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆè¦‹ã‚‹ã¨ãƒšãƒ¼ã‚¸ã‚ã‚Šã™ãã¦ã€Œæ²¼...ã€‚ä»Šã¯ã‚„ã‚ã¦ãŠã“ã†...ã€‚ã€ã¨ãªã‚‹ãƒ¬ãƒ™ãƒ«ã€‚
ã§ã‚‚ã‚„ã‚ŠãŸã„ã“ã¨ã¯ã‚³ãƒ¬ãã‚‰ã„ã®åŠ´åŠ›ã§é”æˆã§ãã¾ã™ã­ã€‚
ãã‚Œã§ã¡ã‚‡ã£ã¨ãšã¤æ²¼ã«ãƒãƒã‚Œã°ã€ã“ã®å…¬å¼ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã®é‡ã¯æœŸå¾…æ„Ÿã—ã‹ãªã„ï¼

ã¨ã„ã†ã“ã¨ã§ã€æ²¼ã«ã¯ã¾ã‚ã†ï¼