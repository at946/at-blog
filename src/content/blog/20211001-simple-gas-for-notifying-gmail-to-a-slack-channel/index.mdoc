---
title: "Gmailã‚’Slackã®ãƒãƒ£ãƒ³ãƒãƒ«ã«é€šçŸ¥ã™ã‚‹è¶…ã‚·ãƒ³ãƒ—ãƒ«ãªGAS"
tags:
  - Google Apps Script
  - Gmail
  - Slack
publicationDate: '2021-10-01'
isPublished: true
---

å‹äººã¨å€‹äººé–‹ç™ºã—ã¦ã¾ã—ã¦ã€å„ç¨®ã‚µãƒ¼ãƒ“ã‚¹ã¯å…±æœ‰ã®Googleã‚¢ã‚«ã‚¦ãƒ³ãƒˆã‚’ä½¿ã£ã¦ã„ã¾ã™ã€‚
ã©ã¡ã‚‰ã‹ã—ã‹é€šçŸ¥ã‚’å—ã‘ã‚‰ã‚Œãªã„ã€æ“ä½œã§ããªã„ã®ã¯é¢å€’ãªã®ã§ã€‚

ã—ã‹ã—ã€è‡ªåˆ†ãŸã¡ã‚‚Googleã‚¢ã‚«ã‚¦ãƒ³ãƒˆã‚’æŒã£ã¦ãŠã‚Šã€Gmailã‚’è¦‹ã‚‹ãŸã‚ã«ã‚¢ã‚«ã‚¦ãƒ³ãƒˆã‚’åˆ‡ã‚Šæ›¿ãˆã‚‹ã®ã¯é¢å€’ã§ã™ã€‚
ã¾ãŸã€ã‚³ãƒŸãƒ¥ãƒ‹ã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã¯Slackã§è¡Œã£ã¦ã„ã‚‹ã®ã§ã€Gmailã‚’Slackã®ãƒãƒ£ãƒ³ãƒãƒ«ã«é€šçŸ¥ã—ã¦Slackã§ä¼šè©±ã§ãã‚‹ã¨ã„ã„ãªãƒ¼ã¨æ€ã£ã¦ã„ã¾ã—ãŸã€‚

è‰²ã€…ã¨èª¿ã¹ã‚‹ã¨ä»¥ä¸‹ã®æ–¹æ³•ãŒç´¹ä»‹ã•ã‚Œã¦ã„ã¾ã—ãŸã€‚

1. Slackã®è»¢é€å…ˆãƒ¡ãƒ¼ãƒ«ã‚¢ãƒ‰ãƒ¬ã‚¹ã‚’Gmailã®è»¢é€å…ˆã«æŒ‡å®šã™ã‚‹
2. Google Workspace Marketplaceã®ã€Œ[Slack for Gmail](https://workspace.google.com/marketplace/app/slack_for_gmail/533288507123?hl=ja)ã€ã‚’ä½¿ã†
2. Slackã®ã€Œ[Email](https://spacesbz.slack.com/apps/A0F81496D-email?tab=more_info)ã€ã‚¢ãƒ—ãƒªã‚’ä½¿ã†
3. GAS

ã—ã‹ã—ãªãŒã‚‰ã€ã©ã‚Œã‚‚è¦ä»¶ã‚’æº€ãŸã™ã®ãŒé›£ã—ãã†ã€‚

`1`ã¯slackbotã¸ã®DMã«ãªã£ã¦ã—ã¾ã„ãƒãƒ£ãƒ³ãƒãƒ«ãƒã‚¹ãƒˆãŒã§ããªãã†ã§ã™ã€‚

`2`ã¯ãƒ–ãƒ©ã‚¦ã‚¶ã§Gmailã‚’é–‹ã„ã¦ã€ãƒ¡ãƒ¼ãƒ«ã”ã¨ãƒãƒ£ãƒ³ãƒãƒ«ã”ã¨ã«æ‰‹ä½œæ¥­ãŒå¿…è¦ã§ã™ã€‚

`3`ã¯ã€ŒEmailã€ã‚¢ãƒ—ãƒªãŒæœ‰æ–™ãƒ¯ãƒ¼ã‚¯ã‚¹ãƒšãƒ¼ã‚¹ã§ãªã„ã¨ä½¿ãˆãªãã†ã§ã™ã€‚

`4`ã¯æ¤œç´¢ã§å¼•ã£ã‹ã‹ã‚‹ã‚³ãƒ¼ãƒ‰ã‚’è¦‹ã‚‹é™ã‚Šã€å‰²ã¨è¤‡é›‘ãã†ã§ã™ã€‚

ã‚“ãƒ¼ã€ã©ã†ã—ãŸã‚‚ã®ã‹ã€‚

ã‚“ã€‚`4`ã€æœ¬å½“ã«è¤‡é›‘ãªã®ã‹ã€‚

ã‚ã‚Œã€ãŠå‰ã€å®Ÿã¯ã‚‚ã£ã¨ã‚·ãƒ³ãƒ—ãƒ«ã«ãªã‚‹ã‚“ã˜ã‚ƒãªã„ã®ã‹ã€‚

ã¨ã„ã†ã“ã¨ã§ã€Gmailã‚’Slackã«é€šçŸ¥ã™ã‚‹GASã¯ã™ã”ãã‚·ãƒ³ãƒ—ãƒ«ã ã‚ˆã€ã®ä¾‹ã‚’ç¤ºã—ã¾ã™ã€‚

## ã‚µãƒ³ãƒ—ãƒ«ã‚³ãƒ¼ãƒ‰

ã„ããªã‚Šã‚µãƒ³ãƒ—ãƒ«ã‚³ãƒ¼ãƒ‰ã§ã™ï¼ˆãƒ¡ãƒ¼ãƒ«ã‚’Slackã«è»¢é€ã—ãŸã„ã‚¢ã‚«ã‚¦ãƒ³ãƒˆã§ã‚„ã£ã¦ãã ã•ã„ï¼‰ã€‚

```js:ã‚³ãƒ¼ãƒ‰.js
function main() {
  const threads = GmailApp.search('in:Inbox is:Unread', 0, 100)
  
  threads.forEach((thread) => {
    thread.getMessages().forEach((message) => {
      if (!message.isUnread()) { return }
      const text = create_message(message)
      send_to_slack(text)
      message.markRead()
    })
  })
}

function create_message(message) {
  return  `[Date] ${message.getDate()}`
          + `\n[From] ${message.getFrom()}` 
          + `\n[Subject] ${message.getSubject()}`
          + `\n[Body]\n${message.getPlainBody()}`
}

function send_to_slack(text) {
  const webhook_url = <Slackã®Incoming webhook URL>
  const headers = { "Content-type": "application/json" }
  const data = { "text": text }
  const options = {
    "method": "post",
    "headers": headers,
    "payload": JSON.stringify(data),
    "muteHttpExceptions": true
  }
  UrlFetchApp.fetch(webhook_url, options)
}
```

`send_to_slack`é–¢æ•°ã¯Slackã«ãƒ†ã‚­ã‚¹ãƒˆãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’é€ã‚‹ã¨ã“ã‚ãªã®ã§ãƒãƒ¼ã‚«ã‚¦ãƒ³ãƒˆï¼ˆã“ã®è¨˜äº‹ã§ã¯èª¬æ˜ã—ã¾ã›ã‚“ï¼‰ã¨ã™ã‚‹ã¨ã€ã‚ã¡ã‚ƒãã¡ã‚ƒã‚·ãƒ³ãƒ—ãƒ«ã˜ã‚ƒã‚ã‚Šã¾ã›ã‚“ã‹ã€‚

JavaScriptã®ã‚³ãƒ¼ãƒ‰ã¯ãŠã„ã¦ãŠã„ã¦ã€GmailAppç³»ã®éƒ¨åˆ†ã‚’ã¡ã‚‡ã£ã¨ã ã‘è§£èª¬ã—ã¾ã™ã€‚

### GmailApp.search()

```js
const threads = GmailApp.search('in:Inbox is:Unread', 0, 100)
```
`GmailApp.search(query, start, max)`ã¯`query`ã®æ¡ä»¶ã«åˆã†ã‚¹ãƒ¬ãƒƒãƒ‰ã®é…åˆ—(`GmailThread[]`)ã‚’å–å¾—ã™ã‚‹é–¢æ•°ã§ã™ã€‚
ä»Šå›ã¯`'in:Inbox is:Unread'`ã‚’æŒ‡å®šã—ã¦ã„ã‚‹ã®ã§ã€ã€Œå—ä¿¡ãƒœãƒƒã‚¯ã‚¹ã€ã®ä¸­ã§ã€Œæœªèª­ã€ã®ã‚‚ã®ã‚’æ‹¾ã£ã¦ãã¾ã™ã€‚
ã¾ãŸã€`start`ã«`0`ã€`max`ã«`100`ã‚’æŒ‡å®šã—ã¦ã„ã‚‹ã®ã§ã€æœ€æ–°ã®ã‚¹ãƒ¬ãƒƒãƒ‰ã‹ã‚‰100ä»¶ã¾ã§ã®ä¸­ã‹ã‚‰`query`ã‚’æ¤œç´¢ã—ã¦ã‚‚ã‚‰ã£ã¦ã„ã¾ã™ã€‚

[Class GmailApp  |  Apps Script  |  Google for Developers | #search(String,Integer,Integer)](https://developers.google.com/apps-script/reference/gmail/gmail-app#search(String,Integer,Integer))

### thread.getMessages()

```js
threads.forEach((thread) => {
  thread.getMessages().forEach((message) => {
    ...
  })
})
```
`GmailThread.getMessages()`ã§ãã®ã‚¹ãƒ¬ãƒƒãƒ‰å†…ã®ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ï¼ˆãƒ¡ãƒ¼ãƒ«ï¼‰ã®é…åˆ—(`GmailMessage[]`)ã‚’å–å¾—ã—ã¦ã¾ã™ã€‚
`forEach`ã‚’ä½¿ãˆã°1ã¤1ã¤ã®ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’æ‰±ãˆã¾ã™ã€‚ã“ã„ã¤ãŒãƒ¡ãƒ¼ãƒ«æœ¬ä½“ã€‚ä¸»å½¹ã®ç™»å ´ã§ã™ã€‚

[Class GmailThread  |  Apps Script  |  Google for Developers | #getMessages()](https://developers.google.com/apps-script/reference/gmail/gmail-thread#getMessages())

### message.isUnread()

```js:function main()
if (!message.isUnread()) { return }
```
`GmailMessage.inUnread()`ã¯ãã®ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ãŒæœªèª­ãªã‚‰`true`ã€æ—¢èª­ãªã‚‰`false`ã‚’è¿”å´ã—ã¾ã™ã€‚
ã“ã®ã‚³ãƒ¼ãƒ‰ã§ã¯ãã‚Œã®å¦å®š(`!`)ã§ifæ–‡ã‚’æ›¸ã„ã¦ã„ã‚‹ã®ã§ã€æ—¢èª­ã®å ´åˆ`return`ã€ã¤ã¾ã‚Šå¾Œç¶šã®å‡¦ç†ã‚’ã›ãšã«`forEach`ã‚’ç¶™ç¶šã•ã›ã¦ã„ã¾ã™ã€‚

[Class GmailMessage  |  Apps Script  |  Google for Developers | #isUnread()](https://developers.google.com/apps-script/reference/gmail/gmail-message#isUnread())

### message.getXXX()

```js:function main()
const text = create_message(message)
 
...

function create_message(message) {
  return  `[Date] ${message.getDate()}`
          + `\n[From] ${message.getFrom()}` 
          + `\n[Subject] ${message.getSubject()}`
          + `\n[Body]\n${message.getPlainBody()}`
}
```
Slackã«æŠ•ç¨¿ã™ã‚‹ãƒ†ã‚­ã‚¹ãƒˆãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’ç”Ÿæˆã—ã¦ã„ã‚‹ã®ãŒã“ã®è¾ºã§ã™ã€‚
`GmailMessage.getXXX()`ã‚’ä½¿ã£ã¦ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’ä½œã£ã¦ã¾ã™ã€‚`getXXX()`ã¯ã„ã‚ã„ã‚ãªç¨®é¡ãŒã‚ã‚‹ã®ã§ã€æŠ•ç¨¿ã—ãŸã„ãƒ†ã‚­ã‚¹ãƒˆãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã«åˆã‚ã›ã¦ã‚«ã‚¹ã‚¿ãƒã‚¤ã‚ºã—ã¦ãã ã•ã„ã€‚
ä»Šå›ã¯ã€ã€Œå—ä¿¡æ—¥æ™‚(`getDate()`)ã€ã€Œé€ä¿¡è€…(`getFrom`)ã€ã€Œã‚¿ã‚¤ãƒˆãƒ«(`getSubject()`)ã€ã€Œãƒ—ãƒ¬ãƒ¼ãƒ³ãƒ†ã‚­ã‚¹ãƒˆã®æœ¬æ–‡(`getPlainBody()`)ã€ã‚’åˆ©ç”¨ã—ã¦ã¿ã¾ã—ãŸã€‚

[Class GmailMessage  |  Apps Script  |  Google for Developers](https://developers.google.com/apps-script/reference/gmail/gmail-message)

### message.markRead()

```js:function main()
message.markRead()
```
æœ€å¾Œã«`message.markRead()`ã§ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’æ—¢èª­ã«ã—ã¦ã„ã¾ã™ã€‚
ã“ã‚Œã§ã€æ¬¡å›ä»¥é™ã¯`!message.isUnread()`ã«å¼¾ã‹ã‚Œã¦å‡¦ç†ã•ã‚Œãªããªã‚Šã¾ã™ã€‚

[Class GmailMessage  |  Apps Script  |  Google for Developers | #markRead()](https://developers.google.com/apps-script/reference/gmail/gmail-message#markRead())

## ã¾ã¨ã‚

ã©ã†ã§ã—ã‚‡ã†ã€‚æ„å¤–ã«ã‚·ãƒ³ãƒ—ãƒ«ã§ã™ã‚ˆã­ã€‚
ã‚ã¨ã¯GASã®ãƒˆãƒªã‚¬ãƒ¼ã‚’å¥½ããªæ™‚é–“å˜ä½ã§æŒ‡å®šã™ã‚Œã°å‡ºæ¥ä¸ŠãŒã‚Šã§ã™ã€‚
åƒ•ãŸã¡ã¯GASã®ã‚¨ãƒ©ãƒ¼é€šçŸ¥ã‚’ã™ãã«å—ä¿¡ã—ãŸã„ã®ã§1åˆ†å˜ä½ã§ãƒˆãƒªã‚¬ãƒ¼ã‚’ã‚»ãƒƒãƒˆã—ã¦ã„ã¾ã™ã€‚

GASã§ã“ã†ã„ã†ã“ã¨ã§ãã‚‹ã‚ˆã€ã¨ã„ã†è¨˜äº‹ã¯ã„ã£ã±ã„ã‚ã‚‹ã®ã§ã™ãŒã€Googleã§æ¤œç´¢ã—ã¦ã‚‚ãªã‹ãªã‹å…¬å¼ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã«ãŸã©ã‚Šç€ã‘ãªã„ã‚“ã§ã™ã‚ˆã­ã€‚
å®Ÿã¯ã‚ã¡ã‚ƒãã¡ã‚ƒã‚ã‹ã‚Šã‚„ã™ã„ã®ã§å…¬å¼ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã‚’çœºã‚ã¦ã‚„ã‚ŠãŸã„ã“ã¨ã‚’å®Ÿç¾ã—ã¦ã„ãã¾ã—ã‚‡ã†ğŸ‘ã€‚

ä¾‹ãˆã°Gmailãªã‚‰  
[Class GmailApp  |  Apps Script  |  Google for Developers](https://developers.google.com/apps-script/reference/gmail/gmail-app)

èª°ã‹ã®ãŸã‚ã«ãªã‚Œã°å¬‰ã—ã„ã§ã™ã€‚ä¸€å¿œä¸å¯§ã«èª¬æ˜ã§ããŸã‹ãªã¨ã€‚
